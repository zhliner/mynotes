主链侧链，交叉签名让两条不同的区块链相互联系

侧链是区块链技术上的一个基本概念，但到目前还没有发展成熟，形成系统的理论。总体上看，侧链的概念应该比较宽泛，这里我们仅从两个不同的区块链间可能存在的交互探讨。缘于区块链采用的非对称加密技术，两条不同的区块链其实可以实现简单的属主验证，这可以模拟一种授权，从而实现某种程度上的链间交互，并且简单明了。原理如下：

签名自证
========
	目的：
		侧链地址证明自己拥有某主链地址的私钥（或得到该私钥授权）。
		即：向外提供证明，某人同时拥有主链和侧链中的两个私钥。
	场景：
		主链上的一个私钥及其公钥对应的地址：P私钥，P地址
		侧链上的一个私钥及其公钥对应的地址：x私钥，x地址
	流程：
		签名 > 传输 > 验证 > 结果
		==>
		P私钥（x地址）= P签名   // x地址作为消息。表示授权，主链的P认可侧链的x
		x私钥（P签名）= x签名   // P签名作为消息。获得授权，签发传递
		==>
		x签名，P签名   // 网络传递到验证者
		==>
		x签名 + P签名 >> 验证-成功1   // 授权文本验证
		P签名 + x地址 >> 验证-成功2   // 授权内容符合性验证
		===
		成功1 + 成功2 => 验证通过
	注：
	- 地址是公钥演算后的值，此处采用对地址而非公钥签名（地址方便并难以欺骗）；
	- 由签名和消息可导出公钥，故公钥无需另外传递；


申请收款
========
	侧链地址对外声明：授权某主链地址接收付款，该主链地址与本侧链地址关联。

	公布数据：
		1. x签名   // 如上
		2. P签名   // 如上
		3. x地址   // 从1+2也可推导出来，此显式声明用于匹配验证）


支付转移
========
	客户主链地址支付币给主链收款地址，同时在侧链内申请用某侧链地址提取权益。
	1. 验证收款申请的主/侧链地址和P签名；
	2. 主链上正常普通支付，获取交易Hash（TxID）；
	3. 侧链内发送必要证明数据，申请权益提取；

	证明数据
	--------
	客户拥有主链数据：C私钥，TxID
	客户拥有侧链数据：k私钥，k地址
		==>
		C私钥（k地址+TxID）= C签名   // 主链私钥授权侧链k地址，同时指定交易ID
		k私钥（C签名）= k签名        // 侧链内签名准备证明数据
		==>
		k签名，C签名，TxID   // 侧链内，发送申请到主链收款地址对应的侧链x地址
		==>
		k签名 + C签名 >> 验证成功 >> k地址
		C签名 + k地址+TxID >> 金额验算，授权匹配 >> 通过
		==>
		x地址 >> 发送权益 >> k地址   // 侧链内普通交易


用途
====
	主链/侧链上各自币的交叉签名可互为验证其属主，这实际上可创建两个不同区块链在“交易级别”上的联系。

	例1：充值消费
	-------------
	某停车场运行一个侧链实例，在显眼的地方发布自己主链的地址进行收费。车主一次性发送10次（或更多）停车费，侧链据此生成停车券。
	停车券作为侧链内部的支付凭证仅在停车场系统内使用，但如果这个停车付费系统是全国连锁，那这个券就可以很方便的使用了（如果你自驾游……）。

	停车付费系统可以定期清算，它们只需将用户的充值返还，即可重置侧链数据，然后重新轻装上线。


	例2：信用借贷
	-------------
	贷款在这里并不需要货币的真正转移：构造一个“2/2”的双重签名地址，A发送一笔资金过去，AB共同签署一个延期返还回A的交易，于是资金即被“冻结”。除非A同意，B无法另行处理该笔资金，到期后A公布此双重签名交易即重获支配权（也可提前发布，但到期才会生效）。

	侧链上可据此创建相应的凭证，用于侧链内自身的业务逻辑，但时间是有限的。到期后A重获资金支配权，这是主链上的交易，侧链无法干预。这样，主链上的贷方实际上可以100%放心的出借自己的资产，甚至无需担心侧链是否运作良好或破产。

	这里，贷出的是信用，虽然感觉上有些别扭，但它却是借贷的本质。


	例3：第三方支付
	---------------
	在第三方支付的逻辑里，支付机构是不可以铸币的，它的交易单位来源于真实货币的“充值”。所以，基于主链充值的侧链实际上可以就是一个“第三方支付”系统。第三方的交接账户（实现主链和侧链价值转接的账户）接收用户的充值，创建本链链内的交易单位。

	因为侧链可对主链清算重置，从而实现本链历史数据的结清归档，故侧链实际上可以支持大量细小的交易，而不必担心块链数据容量的问题。


	例4：铸币委托（链内）
	---------------------
	两对公私钥可相互认证，也使得PoS铸币里的“冷挖矿”概念可以实现（权益验证时针对原始的委托方）。并且，这种委托是开放式的，你可以委托任何一个节点帮你进行PoS挖矿——对挖矿地址签名，然后把签名信息发送给他们。

	这可以帮助任何一个零散的持币用户提取他的币利息（Peercoin），如果适当收费，就为有兴趣创建专业和规模化运营的节点提供了方便（注：对于一个长命的区块链来说，遥远的未来确实需要“专业”和“规模化”的支持——即便它们是个人性质的）。


后记
====
	在阅读到一些关于主链/侧链模型的文章之后，发现大多致力于实现主/侧链的紧密实时交互，甚至不同侧链间通过主链实现直接联系。个人觉得那样的思路十分复杂，并且不知道是否有其实际的使用场景，或是否是合适的方式。

	本人理解的“主/侧链”模型，它们是一种弱关系，即主链对侧链的主动支持十分有限，主链基本上做好它自己就行了。但侧链则依附于主链而存在，依托主链的安全性和信用共享，仅为实现自己专业领域的事而忙碌。不同侧链间的交互是间接的——它们必须通过主链沟通，且受制于主链的工作节奏。

	当然，如果因应于特定的用途，侧链需要与主链紧密协作，上述交易级别的相互认证机制也依然有用：主链上交易的输出部分设定需侧链提供的认证信息——当侧链某个交易提供了签名的认证信息之后，主链上那个交易的输出才会得到有用的值（此时该签名认证信息类似密码的作用）。但这种紧耦合是不便的，它牵扯的东西太多，侧链实现的复杂度会很快上升。






















