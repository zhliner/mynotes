《简单共识，试说PoS权益证明里的确定性随机和随机确定性》

有关区块链技术里PoS权益证明的基本知识，请自行搜索了解，这里开门见山。


确定性随机
==========
	指对确定的数据进行Hash计算，所获得的摘要是确定的，但同时又是不可控的。这类似于一种随机。
	确定性的数据可以是上一个区块的Hash值，即便你有重构整个区块链的权力，你也很难通过改变它们来获得预期的Hash值。


随机确定性
==========
	指用随机的数据作为因子，按确定的方式产生结果（如计算最小值）。因子确定，则结果确定。
	随机因子：通过上述“确定性随机”得到的数据。

	用途：随机因子加上铸块者公钥合并再计算的Hash摘要，也可以认为是随机的（用大量拥有币龄的公钥作为变动因子，以构造预期的Hash值是不可能的）。因此可以用它来构造决胜区块的候选者，与其它因素一起，创建共识模型。


共识模型
========
	候选者
	------
	用“前一区块Hash、铸块者公钥sha256-Hash”合并计算候选者Hash。
	即：Hash (hashPrevBlock + pubkeyhash) => 候选者

	权重因子
	--------
	1. 铸块者公钥币龄；
	2. 交易集全部的总销毁币天数；

	决策过程
	--------
	1. 权益声明：每个节点在出块间隔时间内广播自己的pubkeyhash，声明自己在线并以此信息供其它节点校验和评估；
	2. 自我评估：节点以当前自己打包的区块为目标，根据评选公式评估所有候选者（包括自己）被选中的可能，如果自己位列前茅，则可准备出块；
	3. 出块评选：当达到规定的出块时间间隔后，自我感觉良好的节点发布自己所铸区块，参与竟评；
	注：
	- 规则是确定的，权重因子在区块创建后也是确定的，因此评选结果是确定性的。随机性仅来源于事前；
	- 各节点以自己所铸区块为标准推测评估其它节点的方式并不准确，但结合币龄销毁权重因子的约束，这种模糊评估已足够；
	- 候选者Hash在每一个区块确认后都会发生变化，这种变化可以认为是随机的，因此每一个候选者都有机会获得胜选；
	- 候选者Hash的优先性计算可以取小值优先、大值优先，也或与前两个区块Hash计算接近度（绝对差值）；
	- 并不是每一个节点都必须广播自己的pubkeyhash，这是可选的，这样做是为了优化有效竞争块的发布数量，避免无理拥堵。如果节点认为自己离胜选遥远，或者想给其它节点一个“惊喜”，也可以保持沉默。


运行
====
	区块间隔
	--------
	- 交易本身的时间戳是不准确的，它不会也不必与“真实的时间”吻合，但两个时间戳之间的差值是绝对的，它表达一个真实的时间段。若按一个固定的间隔时间出块，则所有区块的间隔时间之和加上创始区块的时间戳，会与当前现实的时间基本符合（允许适当的误差）；
	- 每一个节点自己本地机器的时间是攻击者没法改变的，因此对这个时间的验证也是可靠的；
	- 按固定的时间出块，各竞争支链的高度会变得一致，因此判断谁为主链将决定于对支链上各块权重因子和候选者的匹配计算。判断选择的验算从支链的分叉点开始，逐个对比计算直到当前最高块，超过半数区块胜出的支链为主链（多个支链可以简化为多个两两对比）；

	激励
	----
	- 一般情况下，交易应当支付一笔交易费，免费模式并不能提供长久的可持续性，费用低廉即是便民，这是一个合理的逻辑；
	- 交易拥有适度代价，既可以抵御无聊的垃圾交易，优化区块体积，也能够为系统的运行提供激励。交易费归铸块者所有，这样使得铸块者会尽量多的打包交易；
	- 为了让自己的区块被认可，铸块者会即时提交区块，并不会一味贪婪等待收集更多的交易谋求不合适的利益。另外，其它节点为了自己可以在新的区块里打包尽量多的交易，也倾向于否定贪婪的区块。这形成了一种对贪婪的强约束，最终，为了得到可行的利益，大家都得守规矩；
	- 交易费是构造一个拥有良好互反馈机制的必不可少的因子。物极必反，在松散难以构造收入来源的P2P里，或许“恰当的”收费才是长久之道（注：公司化运作的免费模式——如杀毒，他们也在通过模式衍生的渠道获益，并非慈善）；

	攻击
	----
	- 区块的Hash受交易影响而变化，当攻击者对块链进行分叉后，攻击区块的Hash会不同，其它节点不会基于此参与竟评。攻击者只能凭借自己的权益（币龄和公钥数量）和所有其它在线的有权铸块者的全部权益竞争，从“概率”上取胜；
	- 每一个区块的Hash与前一个区块相关联，因此攻击支链上的全部区块的Hash都会被改变，每一次，攻击者都需要单独和全网竞争，随着块链长度的增长，更多或不同的权益者上线，攻击者需要和越来越多的权益拼好运。如果有权铸块的节点足够多，攻击者获胜的概率就会越小，低的获胜率会大幅削弱攻击者的利益驱动；
	- 攻击者只需要和在线的权益者竞争，刚开始分叉时相对容易，但随着时间的推移，不同的权益者上线，攻击者越来越需要更多的权益才能取胜——直至全网权益的50%；
	- 和PoW一样，占据50%以上算力的节点可以完全控制区块链，拥有50%以上权益的节点同样可以完全控制PoS区块链。但和PoW不一样的是，在PoS中，攻击者需要拥有系统直接的权益，当成功的攻击出现后，系统名誉上的受损会直接影响攻击者已有的利益——拥有大量权益的攻击者实施的攻击，实际上是在攻击他自己；
	- 我们只能假设这种情况不会出现。当然，逻辑上，权益者想要毁掉自己的权益，也是他本有的权利，我们无法改变这点；
	- 攻击者不仅需要大量的币龄，还需要大量的拥有币龄的公钥，如果系统运行时间足够长，使用者的增加会使公钥数量无限增长。这样，攻击者即便拥有大量币龄，要实施攻击，他还必须先把这些权益分散到数十万（甚至更多）的公钥上去……好疯狂！为了摧毁自己，还不得不那么的不辞辛劳；


结语
====
	本质上，PoW也是借助于Hash的随机性获得共识能力，它们都依赖于概率和攻击代价设计上的保护。专业矿机的高算力并不能提高攻击者的门槛，相反，它反而提高了普通进入者的门槛，降低了“概率”对系统的保护。对于PoW，抛开资源消耗不谈，我们设想一个场景：在某个币价低迷的时代，矿机大量停机，矿场坚持不住然后低价转让……有心人购入，不高的成本控制了大量算力……。

	其实在PoW里，攻击者无需亲自制造大量算力——购入矿机即可。矿机的高算力只是一种假象，它相比于传统计算机的Hash能力遥遥领先，但攻击者已经不必借助传统计算机来实施攻击了。以彼之矛攻彼之盾，水涨船高的道理。

	Bitcoin系统采用工作量证明（PoW）来实现出块时间的控制，并依此构造共识机制（谁先完成谁胜出），是编程中复用哲学的体现，无可厚非。PoS权益证明是把币龄理解为另一种“工作量”而推导出来的机制，可以避免PoW消耗资源的弊端，但依然不算完美（复杂，太依赖于权益，可靠性并不足够高）。本文从PoS的基本原理上开始思考，发掘Hash算法所能实现的随机性和确定性，模拟随机概率，借助于“时间间隔”的绝对性，试图建立一个简单但强壮的共识模型。

	欢迎批评指正。


作者：@比特点点 zhliner@gmail.com

施主慈悲：PXheD3xDPu2ZXUmjrXSDFZ4Yi3YJM3kmTu，1Q7U45ZNLyYNYe6yWT7gaf6H6JNRB9Jeih ^^


补充
====
	如果借助于另一条不同区块链认证，则安全性会加倍，攻击者需要同时掌控那一条块链才行！



